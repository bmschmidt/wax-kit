import{S as t,i,s as n,l as e,f as a,G as l,d as o,t as s,g as c,h as r,O as u,e as f,c as d,a as h,b as p,F as m,P as g,k as b,n as $,T as v,U as j}from"../../chunks/vendor-33472b1e.js";import{b as w}from"../../chunks/paths-2c73d5fe.js";import{d as I}from"../../chunks/OMG_THIS_IS_HACKY_BUT_ITD_BE_A_DATABASE-bda68cd3.js";let k="https://bmschmidt.github.io/wax-kit/",x="https://iiif.benschmidt.org/iiif/2";const E=I,y={};async function A(t){return async function(t){const i=[await _(t)],n=E.filter((i=>i.pid==t))[0],e=(await D(t))[0];if(void 0===e)throw"IS UNDEFINED";const a=e["@id"];return{"@context":"http://iiif.io/api/presentation/2/context.json","@id":`${k}/iiif/${t}`,"@type":"sc:Manifest",metadata:Object.entries(n).filter((([t,i])=>t&&i)).map((([t,i])=>({label:t,value:i}))),label:`${n.label}`,thumbnail:`${x}/${t}/full/250,/0/default.jpg`,viewingDirection:"left-to-right",viewingHint:"individuals",sequences:i,full:`${x}/${a}/full/full/0/default.jpg`,fullwidth:`${x}/${a}/full/${e.width},/0/default.jpg`}}(t).thumbnail}async function D(t){if(y[t])return y[t];let i;i=E.filter((i=>i.pid==t))[0]["wax:images"];const n=i[0];console.log(`${x}/${n}/info.json`);const e=i.map((t=>`${x}/${t}/info.json`)).map((t=>fetch(t).then((t=>t.json())))),a=await Promise.all(e);return y[t]=a,a}async function _(t){const i=await D(t);if(0===i.length)throw"IS UNDEFINED";i[0]["@id"];return{"@id":`${k}/iiif/sequence/${t}.json`,"@type":"sc:Sequence",canvases:i.map((t=>function(t){const i=t["@id"],n=i.split("/").pop(),e=`${k}/iiif/canvas/${n}.json`;return{"@type":"sc:Canvas","@id":e,label:"front",width:2501,height:4331,thumbnail:`${x}/${n}/full/250,/0/default.jpg`,images:[{"@type":"oa:Annotation","@id":`${k}/iiif/annotation/${n}.json`,motivation:"sc:painting",resource:{"@id":`${i}/full/full/0/default.jpg`,"@type":"dcterms:Image",format:"image/jpeg",service:{"@context":"http://iiif.io/api/image/2/context.json","@id":i,profile:"http://iiif.io/api/image/2/level2.json"},width:t.width,height:t.height},on:e}]}}(t)))}}function S(t){let i,n,e;return{c(){i=s("Could not find an id for "),n=s(t[0]),e=s(";")},l(a){i=c(a,"Could not find an id for "),n=c(a,t[0]),e=c(a,";")},m(t,l){a(t,i,l),a(t,n,l),a(t,e,l)},p(t,i){1&i&&r(n,t[0])},d(t){t&&o(i),t&&o(n),t&&o(e)}}}function C(t){let i,n,e,l,s,c={ctx:t,current:null,token:null,hasCatch:!1,pending:F,then:T,catch:N,value:3};return u(l=t[2],c),{c(){i=f("div"),n=f("a"),e=f("figure"),c.block.c(),this.h()},l(t){i=d(t,"DIV",{class:!0,id:!0});var a=h(i);n=d(a,"A",{href:!0});var l=h(n);e=d(l,"FIGURE",{});var s=h(e);c.block.l(s),s.forEach(o),l.forEach(o),a.forEach(o),this.h()},h(){p(n,"href",s=w+"/"+t[1].collection+"/"+t[0]+"/"),p(i,"class","thumb svelte-4dxg8"),p(i,"id",t[0])},m(t,l){a(t,i,l),m(i,n),m(n,e),c.block.m(e,c.anchor=null),c.mount=()=>e,c.anchor=null},p(e,a){t=e,c.ctx=t,4&a&&l!==(l=t[2])&&u(l,c)||g(c,t,a),3&a&&s!==(s=w+"/"+t[1].collection+"/"+t[0]+"/")&&p(n,"href",s),1&a&&p(i,"id",t[0])},d(t){t&&o(i),c.block.d(),c.token=null,c=null}}}function N(t){return{c:l,l:l,m:l,p:l,d:l}}function T(t){let i,n,e,l,u,g,w=t[1].label+"";return{c(){i=f("img"),l=b(),u=f("figcaption"),g=s(w),this.h()},l(t){i=d(t,"IMG",{src:!0,alt:!0,style:!0}),l=$(t),u=d(t,"FIGCAPTION",{});var n=h(u);g=c(n,w),n.forEach(o),this.h()},h(){v(i.src,n=t[3])||p(i,"src",n),p(i,"alt",e="Improve alt-text: "+t[1].label),j(i,"width","100%")},m(t,n){a(t,i,n),a(t,l,n),a(t,u,n),m(u,g)},p(t,a){4&a&&!v(i.src,n=t[3])&&p(i,"src",n),2&a&&e!==(e="Improve alt-text: "+t[1].label)&&p(i,"alt",e),2&a&&w!==(w=t[1].label+"")&&r(g,w)},d(t){t&&o(i),t&&o(l),t&&o(u)}}}function F(t){let i;return{c(){i=s("[Looking for thumbnail]")},l(t){i=c(t,"[Looking for thumbnail]")},m(t,n){a(t,i,n)},p:l,d(t){t&&o(i)}}}function G(t){let i;function n(t,i){return t[1]&&t[0]?C:S}let s=n(t),c=s(t);return{c(){c.c(),i=e()},l(t){c.l(t),i=e()},m(t,n){c.m(t,n),a(t,i,n)},p(t,[e]){s===(s=n(t))&&c?c.p(t,e):(c.d(1),c=s(t),c&&(c.c(),c.m(i.parentNode,i)))},i:l,o:l,d(t){c.d(t),t&&o(i)}}}function U(t,i,n){let e,{datum:a}=i,{pid:l}=i;return l?e=A(l):null==a||(l=a.pid),t.$$set=t=>{"datum"in t&&n(1,a=t.datum),"pid"in t&&n(0,l=t.pid)},[l,a,e]}export default class extends t{constructor(t){super(),i(this,t,U,G,n,{datum:1,pid:0})}}

import{S as t,i,s as n,l as a,f as e,G as l,d as o,t as s,g as c,h as r,O as u,e as f,c as d,a as h,b as p,F as m,P as g,k as b,n as $,T as v,U as j}from"../../chunks/vendor-33472b1e.js";import{b as w}from"../../chunks/paths-2c73d5fe.js";import{d as I}from"../../chunks/OMG_THIS_IS_HACKY_BUT_ITD_BE_A_DATABASE-bda68cd3.js";let k="https://bmschmidt.github.io/wax-kit/",x="https://iiif.benschmidt.org/iiif/2";const E=I,y={};async function A(t){return await async function(t){const i=[await _(t)],n=E.filter((i=>i.pid==t))[0],a=(await D(t))[0];if(void 0===a)throw"IS UNDEFINED";const e=a["@id"];return{"@context":"http://iiif.io/api/presentation/2/context.json","@id":`${k}/iiif/${t}`,"@type":"sc:Manifest",metadata:Object.entries(n).filter((([t,i])=>t&&i)).map((([t,i])=>({label:t,value:i}))),label:`${n.label}`,thumbnail:`${x}/${t}/full/250,/0/default.jpg`,viewingDirection:"left-to-right",viewingHint:"individuals",sequences:i,full:`${x}/${e}/full/full/0/default.jpg`,fullwidth:`${x}/${e}/full/${a.width},/0/default.jpg`}}(t).thumbnail}async function D(t){if(y[t])return y[t];let i;i=E.filter((i=>i.pid==t))[0]["wax:images"];const n=i[0];console.log(`${x}/${n}/info.json`);const a=i.map((t=>`${x}/${t}/info.json`)).map((t=>fetch(t).then((t=>t.json())))),e=await Promise.all(a);return y[t]=e,e}async function _(t){const i=await D(t);if(0===i.length)throw"IS UNDEFINED";i[0]["@id"];return{"@id":`${k}/iiif/sequence/${t}.json`,"@type":"sc:Sequence",canvases:i.map((t=>function(t){const i=t["@id"],n=i.split("/").pop(),a=`${k}/iiif/canvas/${n}.json`;return{"@type":"sc:Canvas","@id":a,label:"front",width:2501,height:4331,thumbnail:`${x}/${n}/full/250,/0/default.jpg`,images:[{"@type":"oa:Annotation","@id":`${k}/iiif/annotation/${n}.json`,motivation:"sc:painting",resource:{"@id":`${i}/full/full/0/default.jpg`,"@type":"dcterms:Image",format:"image/jpeg",service:{"@context":"http://iiif.io/api/image/2/context.json","@id":i,profile:"http://iiif.io/api/image/2/level2.json"},width:t.width,height:t.height},on:a}]}}(t)))}}function S(t){let i,n,a;return{c(){i=s("Could not find an id for "),n=s(t[0]),a=s(";")},l(e){i=c(e,"Could not find an id for "),n=c(e,t[0]),a=c(e,";")},m(t,l){e(t,i,l),e(t,n,l),e(t,a,l)},p(t,i){1&i&&r(n,t[0])},d(t){t&&o(i),t&&o(n),t&&o(a)}}}function C(t){let i,n,a,l,s,c={ctx:t,current:null,token:null,hasCatch:!1,pending:F,then:T,catch:N,value:3};return u(l=t[2],c),{c(){i=f("div"),n=f("a"),a=f("figure"),c.block.c(),this.h()},l(t){i=d(t,"DIV",{class:!0,id:!0});var e=h(i);n=d(e,"A",{href:!0});var l=h(n);a=d(l,"FIGURE",{});var s=h(a);c.block.l(s),s.forEach(o),l.forEach(o),e.forEach(o),this.h()},h(){p(n,"href",s=w+"/"+t[1].collection+"/"+t[0]+"/"),p(i,"class","thumb svelte-4dxg8"),p(i,"id",t[0])},m(t,l){e(t,i,l),m(i,n),m(n,a),c.block.m(a,c.anchor=null),c.mount=()=>a,c.anchor=null},p(a,e){t=a,c.ctx=t,4&e&&l!==(l=t[2])&&u(l,c)||g(c,t,e),3&e&&s!==(s=w+"/"+t[1].collection+"/"+t[0]+"/")&&p(n,"href",s),1&e&&p(i,"id",t[0])},d(t){t&&o(i),c.block.d(),c.token=null,c=null}}}function N(t){return{c:l,l:l,m:l,p:l,d:l}}function T(t){let i,n,a,l,u,g,w=t[1].label+"";return{c(){i=f("img"),l=b(),u=f("figcaption"),g=s(w),this.h()},l(t){i=d(t,"IMG",{src:!0,alt:!0,style:!0}),l=$(t),u=d(t,"FIGCAPTION",{});var n=h(u);g=c(n,w),n.forEach(o),this.h()},h(){v(i.src,n=t[3])||p(i,"src",n),p(i,"alt",a="Improve alt-text: "+t[1].label),j(i,"width","100%")},m(t,n){e(t,i,n),e(t,l,n),e(t,u,n),m(u,g)},p(t,e){4&e&&!v(i.src,n=t[3])&&p(i,"src",n),2&e&&a!==(a="Improve alt-text: "+t[1].label)&&p(i,"alt",a),2&e&&w!==(w=t[1].label+"")&&r(g,w)},d(t){t&&o(i),t&&o(l),t&&o(u)}}}function F(t){let i;return{c(){i=s("[Looking for thumbnail]")},l(t){i=c(t,"[Looking for thumbnail]")},m(t,n){e(t,i,n)},p:l,d(t){t&&o(i)}}}function G(t){let i;function n(t,i){return t[1]&&t[0]?C:S}let s=n(t),c=s(t);return{c(){c.c(),i=a()},l(t){c.l(t),i=a()},m(t,n){c.m(t,n),e(t,i,n)},p(t,[a]){s===(s=n(t))&&c?c.p(t,a):(c.d(1),c=s(t),c&&(c.c(),c.m(i.parentNode,i)))},i:l,o:l,d(t){c.d(t),t&&o(i)}}}function U(t,i,n){let a,{datum:e}=i,{pid:l}=i;return l?a=A(l):null==e||(l=e.pid),t.$$set=t=>{"datum"in t&&n(1,e=t.datum),"pid"in t&&n(0,l=t.pid)},[l,e,a]}export default class extends t{constructor(t){super(),i(this,t,U,G,n,{datum:1,pid:0})}}
